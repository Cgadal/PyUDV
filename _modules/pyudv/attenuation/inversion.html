
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pyudv.attenuation.inversion &#8212; pyudv  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/pydata-custom.css?v=2e59d9c9" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script src="../../../_static/documentation_options.js?v=7f41d439"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pyudv/attenuation/inversion';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">pyudv</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../index.html">
                        Home page
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../_examples/index.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../_autosummary/pyudv.html">
                        API reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/cgadal-pythonpackages/pyudv" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../index.html">
                        Home page
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../_examples/index.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../_autosummary/pyudv.html">
                        API reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/cgadal-pythonpackages/pyudv" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">pyudv.attenu...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for pyudv.attenuation.inversion</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span> <span class="k">as</span> <span class="nn">scipyint</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">scipyinter</span>

<span class="kn">from</span> <span class="nn">pyudv.attenuation.direct_models</span> <span class="kn">import</span> <span class="n">correction_factor</span>

<span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Explicit inversion scheme --</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">_explicit_solution_form</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Xi</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="n">integral</span> <span class="o">=</span> <span class="n">scipyint</span><span class="o">.</span><span class="n">cumulative_trapezoid</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">Xi</span> <span class="o">*</span> <span class="n">integral</span><span class="p">),</span> <span class="n">f</span>


<div class="viewcode-block" id="explicit_inversion">
<a class="viewcode-back" href="../../../_autosummary/pyudv.attenuation.inversion.explicit_inversion.html#pyudv.attenuation.explicit_inversion">[docs]</a>
<span class="k">def</span> <span class="nf">explicit_inversion</span><span class="p">(</span>
    <span class="n">MSV</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">r</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">Xi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">alpha_w</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">psi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">C0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">r0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">delta_r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cubic&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the following explicit solution to infer particle concentration from Mean Square Voltage (MSV, :math:`\langle V^{2} \rangle`) data:</span>

<span class="sd">    .. math::</span>

<span class="sd">        C(r) = \frac{f}{B - 4\xi\displaystyle\int^{r}f},</span>

<span class="sd">    where</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(r) = \langle V^{2} \rangle \left(\frac{r\psi_{(r)}}{K_{\rm s} K_{\rm t}}\right) e^{4r\alpha_{\rm w}} = Ce^{-4\alpha_{\rm s}}.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    MSV : np.ndarray</span>
<span class="sd">        Input array containing :math:`\langle V^{2} \rangle` data. If 1D, must be the same size as `r`. If 2D, its last dimension must match the size of `r`.</span>
<span class="sd">    r : np.ndarray</span>
<span class="sd">        Radial distance to the probe array. Must be 1D, and match the last dimension of `MSV`.</span>
<span class="sd">    Xi : float</span>
<span class="sd">        sediment asborption coefficient.</span>
<span class="sd">    alpha_w : float</span>
<span class="sd">        water absorption coefficient.</span>
<span class="sd">    psi : np.ndarray</span>
<span class="sd">        Near-field function. Must be 1D, and match the last dimension of `MSV`.</span>
<span class="sd">    C0 : float | np.ndarray</span>
<span class="sd">        Reference concentration. Can be a float, or a 1D array matching the first dimension of `MSV`.</span>
<span class="sd">    r0 : float</span>
<span class="sd">        Reference distance corresponding to `C0`.</span>
<span class="sd">    delta_r : float, optional</span>
<span class="sd">        If not None, the reference concentration is then interpreted as an average between :math:`r-\delta r` and :math:`r+\delta r` (by default None).</span>
<span class="sd">    n_interp : int, optional</span>
<span class="sd">        Number of point used in the interpolation of the input signal, by default 1000. It is advise to vary this parameter to find its lowest value above which the result becomes independant of it.</span>
<span class="sd">    kind : str, optional</span>
<span class="sd">        Interpolation method used, by default &quot;cubic&quot;. Refer to the documentation of :func:`interp1d &lt;scipy.interpolate.interp1d&gt;`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    C : np.ndarray</span>
<span class="sd">        Inferred concentration.</span>
<span class="sd">    f : np.ndarray</span>
<span class="sd">        Integrated array during the procedure. Returned to check the order of magnitudes over wich the integration is performed, and check possible numerical precision errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">r_expanded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">MSV</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
    <span class="p">)</span>
    <span class="n">psi_expanded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">psi</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">MSV</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
    <span class="p">)</span>
    <span class="n">C0_expanded</span> <span class="o">=</span> <span class="n">C0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">C0</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">C0</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="c1">#</span>
    <span class="c1"># ## calculating MSV reduced of factor</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">correction_factor</span><span class="p">(</span><span class="n">r_expanded</span><span class="p">,</span> <span class="n">alpha_w</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">psi_expanded</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">MSV</span> <span class="o">/</span> <span class="n">factor</span>
    <span class="n">interp_f</span> <span class="o">=</span> <span class="n">scipyinter</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span>
    <span class="c1"># ## calculating adjustable constant with imposed point</span>
    <span class="n">r_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">r0</span><span class="p">,</span> <span class="n">n_interp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">delta_r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if single fixed point</span>
        <span class="n">constant_int</span> <span class="o">=</span> <span class="n">scipyint</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">interp_f</span><span class="p">(</span><span class="n">r_new</span><span class="p">),</span> <span class="n">r_new</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">constant_MSV</span> <span class="o">=</span> <span class="n">interp_f</span><span class="p">(</span><span class="n">r0</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">constant_MSV</span> <span class="o">/</span> <span class="n">C0_expanded</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">Xi</span> <span class="o">*</span> <span class="n">constant_int</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># if averaged within delta_r</span>
        <span class="n">r_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">delta_r</span><span class="p">,</span> <span class="n">n_interp</span><span class="p">)</span>
        <span class="n">constant_int_pos</span> <span class="o">=</span> <span class="n">scipyint</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">interp_f</span><span class="p">(</span><span class="n">r_new</span><span class="p">),</span> <span class="n">r_new</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="n">r_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">r0</span> <span class="o">-</span> <span class="n">delta_r</span><span class="p">,</span> <span class="n">n_interp</span><span class="p">)</span>
        <span class="n">constant_int_neg</span> <span class="o">=</span> <span class="n">scipyint</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">interp_f</span><span class="p">(</span><span class="n">r_new</span><span class="p">),</span> <span class="n">r_new</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">4</span>
            <span class="o">*</span> <span class="n">Xi</span>
            <span class="o">*</span> <span class="p">(</span>
                <span class="n">constant_int_pos</span>
                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span> <span class="o">*</span> <span class="n">delta_r</span> <span class="o">*</span> <span class="n">Xi</span> <span class="o">*</span> <span class="n">C0_expanded</span><span class="p">)</span> <span class="o">*</span> <span class="n">constant_int_neg</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span> <span class="o">*</span> <span class="n">delta_r</span> <span class="o">*</span> <span class="n">Xi</span> <span class="o">*</span> <span class="n">C0_expanded</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">_explicit_solution_form</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Xi</span><span class="p">,</span> <span class="n">r_expanded</span><span class="p">)</span></div>



<span class="c1">#</span>
<span class="c1"># def explicit_inversion(MSV, r, Xi, alpha_w, psi, C0, r0):</span>
<span class="c1">#     r_expanded = np.expand_dims(r, axis=tuple(np.arange(len(MSV.shape[:-1]))))</span>
<span class="c1">#     psi_expanded = np.expand_dims(psi, axis=tuple(np.arange(len(MSV.shape[:-1]))))</span>
<span class="c1">#     C0_expanded = np.expand_dims(C0, axis=-1)</span>
<span class="c1">#     #</span>
<span class="c1">#     factor = correction_factor(r_expanded, alpha_w, 1, 1, psi_expanded)</span>
<span class="c1">#     MSV_reduced = MSV/factor</span>
<span class="c1">#     #</span>
<span class="c1">#     integral = cumulative_trapezoid(MSV_reduced, r_expanded, initial=0)</span>
<span class="c1">#     if np.isscalar(r0):</span>
<span class="c1">#         ind_r0 = np.arange(r.size)[r &lt;= r0][-1]</span>
<span class="c1">#         constant_int = trapezoid(MSV_reduced[..., :ind_r0], r_expanded[..., :ind_r0])</span>
<span class="c1">#         return C0_expanded*MSV_reduced/(MSV_reduced[..., ind_r0:ind_r0 + 1] - C0_expanded*4*Xi*(integral - constant_int[..., None]))</span>
<span class="c1">#     else:</span>
<span class="c1">#         r_temp = np.broadcast_to(r_expanded, MSV_reduced.shape)</span>
<span class="c1">#         MSV_zeroed = np.where(r_temp &lt;= r0[..., None], MSV_reduced, 0)</span>
<span class="c1">#         del r_temp</span>
<span class="c1">#         constant_int = trapezoid(MSV_zeroed, r_expanded)</span>
<span class="c1">#         del MSV_zeroed</span>
<span class="c1">#         #</span>
<span class="c1">#         ind_r0 = np.argmin(np.abs(r0[..., None] - r_expanded), axis=-1)</span>
<span class="c1">#         constant_MSV = np.take_along_axis(MSV_reduced, ind_r0[..., None], axis=-1)</span>
<span class="c1">#         del ind_r0</span>
<span class="c1">#         return C0_expanded*MSV_reduced/(constant_MSV - C0_expanded*4*Xi*(integral - constant_int[..., None]))</span>
</pre></div>

                </article>
              
              
              
              
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, Cyril Gadal.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>